#include <stdlib.h>
#include <stdio.h>

#include "tlv.h"

static bool print_cb(void *data, const struct tlv_elem_info *tei)
{
	if (!tei) {
		printf("NULL\n");
		return false;
	}
	printf("%hx %x\n", tei->tag, tei->len);

	return true;
}

int main(void) {
	struct tlv *t;
	const unsigned char buf[] = {0x6f, 0x1a, 0x84, 0x0e, 0x31, 0x50, 0x41, 0x59, 0x2e, 0x53, 0x59, 0x53, 0x2e, 0x44, 0x44, 0x46, 0x30, 0x31, 0xa5, 0x08, 0x88, 0x01, 0x02, 0x5f, 0x2d, 0x02, 0x65, 0x6e};
	t = tlv_parse(buf, sizeof(buf));

	if (t) {
		tlv_visit(t, print_cb, NULL);
		print_cb(NULL, tlv_get(t, 0x88));
		tlv_free(t);
	}

	const unsigned char buf2[] = {0x6f, 0x19, 0x84, 0x0e, 0x31, 0x50, 0x41, 0x59, 0x2e, 0x53, 0x59, 0x53, 0x2e, 0x44, 0x44, 0x46, 0x30, 0x31, 0xa5, 0x07, 0x88, 0x01, 0x02, 0x5f, 0x2d, 0x02, 0x65};
	t = tlv_parse(buf2, sizeof(buf2));
	if (t) {
		tlv_visit(t, print_cb, NULL);
		print_cb(NULL, tlv_get(t, 0x88));
		tlv_free(t);
	}


	return 0;
}
